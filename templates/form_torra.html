{% extends 'base.html' %}

{% block body %}
<script type="text/javascript">{{js}}</script>
<div class='container form_torra'  style='display: flex;'>
    <div class='div_formulario mt-3'>
        <form action="insere_torra" method='post' id='form-torra' class='needs-validation' novalidate>
                <div class='form-floating'>
                    <input required class='form-control fit_content' type='date' name='data' id='data'>
                    <label for='data' style='display:block;text-align:right;'>data da torra</label>
                </div>
                <div class='form-floating'>
                    {{select_cafes|safe}}
                    <label for='cafe'>descrição do café</label>
                </div>
                <div class='form-floating'>
                    <input required class='form-control fit_content' type='number' step='0.01' name='temp_inicial'
                        id='temp_inicial'>
                    <label id='label_temp_inicial' for='temp_inicial'>temperatura inicial</label>
                </div>
                <div class='form-floating'>
                    <input class='form-control fit_content' required type='number' step='0.01' name='temp_final' id='temp_final'>
                    <label for='temp_final'>temperatura final</label>
                </div>

                <div class='form-floating'>
                    <input class='form-control fit_content' type='number' step='0.01' name='piso' id='piso'>
                    <label for='piso'>piso</label>
                </div>

                <div class='form-floating'>
                    <input class='form-control fit_content' type='number' step='0.01' name='fluxo_ar' id='fluxo_ar'>
                    <label for='fluxo_ar'>fluxo de ar</label>
                </div>

                <div class='form-floating'>
                    <input class='form-control fit_content' type='number' step='0.01' name='velocidade_tambor'
                        id='velocidade_tambor'>
                    <label for='velocidade_tambor'>velocidade do tambor</label>
                </div>

                <div class='form-floating'>
                    <input class='form-control fit_content' type='number' step='0.01' name='peso' id='peso'>
                    <label for='peso'>peso</label>
                </div>
                <div class='form-floating'>
                    <textarea class='form-control' type='date' name='observacoes' id='observacoes'></textarea>
                    <label for='data' style='display:block;text-align:right;'>observações</label>
                </div>
    
                <table class='table' style='border: 1px steelblue solid;'>
                    <tr>
                        <td>
                            <div class='row justify-content-center' style='margin: 1em 0;'>
                                <div class='inputGrid'
                                    style='margin: 0 auto; text-align: center;'>
                                    <div id="inputFormRow">
                                        <div class='tempgrid mt-2'>
                                            <h5 style='color: #e6e6fa'>GRID</h5>
                                        </div>
                                        <div class='tempgrid mt-2'>
                                            <input type="number" step='0.01' class='inputGrid' id='tempgrid1'
                                                name="tempgrid1" autocomplete="off" style='margin-right: 4em;'>
                                        </div>
                                    </div>

                                    <div id="newRow"></div>

                                    <button id="addRow" type="button" class='btn btn-outline-light btn-sm'
                                        style='width: 9em;'>
                                        ✚
                                    </button>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class='form-floating d-flex'>
                                <button type='submit' class='btn botao_medio'>salvar</button>
                            </div>
                        </td>
                    </tr>
                </table>
    
        </form>
    </div>
</div>


<script type="text/javascript">

    // add row
    var tempgrid = 1;
    if (temperaturas.length > 0) {
        document.getElementById("label_temp_inicial").append(" (" + temperaturas.shift() + ")");
        document.getElementById("tempgrid1").setAttribute("placeholder", temperaturas.shift());
    }
    $("#addRow").click(function () {
        var html = '';

        tempgrid += 1
        html += '<div id="inputFormRow">';
        if (temperaturas.length > 0) {
            html += '<input placeholder="' + temperaturas.shift() + '" type="number" step="0.01" class="inputGrid" name="tempgrid' + tempgrid + '" autocomplete="off" style="width:4em">';
        } else {
            html += '<input type="number" step="0.01" class="inputGrid" name="tempgrid' + tempgrid + '" autocomplete="off" style="width:4em">';
        }
        html += '<button id="removeRow" type="button" title="apaga o campo ' + tempgrid + '" class="btn btn-danger btn-sm" style="width:4em">' + tempgrid + '</button><br>';
        html += '</div>';

        $('#newRow').append(html);
        $('html,body').animate({ scrollTop: document.body.scrollHeight }, "fast");
        $("form").find("input:last").focus();
    });

    // remove row
    $(document).on('click', '#removeRow', function () {
        $(this).closest('#inputFormRow').remove();
    });

    document.querySelector('#form-torra').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            $('#addRow').click();
            event.preventDefault();
        }
    });

</script>
{% endblock %}